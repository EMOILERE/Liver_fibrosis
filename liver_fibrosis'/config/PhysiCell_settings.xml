<?xml version="1.0" encoding="UTF-8"?>
<!--
###############################################################################
# iGEM Liver Fibrosis Simulation Configuration                               #
# Models LX-2 hepatic stellate cells response to miRNA-loaded exosomes       #
# Focuses on TGF-β1 activation and miRNA synergistic anti-fibrotic effects   #
###############################################################################
-->

<PhysiCell_settings version="devel-version">

    <domain>
        <x_min>-400</x_min>
        <x_max>400</x_max>
        <y_min>-400</y_min>
        <y_max>400</y_max>
        <z_min>-10</z_min>
        <z_max>10</z_max>
        <dx>20</dx>
        <dy>20</dy>
        <dz>20</dz>
        <use_2D>true</use_2D>
    </domain>

    <overall>
        <max_time units="min">2880</max_time>  <!-- 48 hours -->
        <time_units>min</time_units>
        <space_units>micron</space_units>
        <dt_diffusion units="min">0.01</dt_diffusion>
        <dt_mechanics units="min">0.1</dt_mechanics>
        <dt_phenotype units="min">6</dt_phenotype>
    </overall>

    <parallel>
        <omp_num_threads>6</omp_num_threads>
    </parallel>

    <save>
        <folder>output</folder>
        <full_data>
            <interval units="min">60</interval>
            <enable>true</enable>
        </full_data>
        <SVG>
            <interval units="min">60</interval>
            <enable>true</enable>
            <plot_substrate enabled="true" limits="true">
                <substrate>TGF_beta1</substrate>
                <colormap>YlOrRd</colormap>
                <min_conc>0</min_conc>
                <max_conc>10</max_conc>
            </plot_substrate>
        </SVG>
        <legacy_data>
            <enable>false</enable>
        </legacy_data>
    </save>

    <options>
        <legacy_random_points_on_sphere_in_divide>false</legacy_random_points_on_sphere_in_divide>
        <virtual_wall_at_domain_edge>true</virtual_wall_at_domain_edge>
        <disable_automated_spring_adhesions>false</disable_automated_spring_adhesions>
        <random_seed>0</random_seed>
    </options>

    <microenvironment_setup>
        <!-- TGF-β1: Key fibrosis inducer (10 ng/mL experimental concentration) -->
        <variable name="TGF_beta1" units="ng/mL" ID="0">
            <physical_parameter_set>
                <diffusion_coefficient units="micron^2/min">50000.0</diffusion_coefficient>
                <decay_rate units="1/min">0.01</decay_rate>  <!-- Half-life ~70 min -->
            </physical_parameter_set>
            <initial_condition units="ng/mL">10.0</initial_condition>
            <Dirichlet_boundary_condition units="ng/mL" enabled="false">10.0</Dirichlet_boundary_condition>
        </variable>

        <!-- Exosomes: Carrier particles for miRNA delivery (50 μg/mL experimental) -->
        <variable name="exosomes" units="ug/mL" ID="1">
            <physical_parameter_set>
                <diffusion_coefficient units="micron^2/min">5000.0</diffusion_coefficient>
                <decay_rate units="1/min">0.005</decay_rate>  <!-- Slow degradation -->
            </physical_parameter_set>
            <initial_condition units="ug/mL">0.0</initial_condition>
            <Dirichlet_boundary_condition units="ug/mL" enabled="false">0.0</Dirichlet_boundary_condition>
        </variable>

        <!-- α-SMA: Key fibrosis marker protein -->
        <variable name="alpha_SMA" units="dimensionless" ID="2">
            <physical_parameter_set>
                <diffusion_coefficient units="micron^2/min">10000.0</diffusion_coefficient>
                <decay_rate units="1/min">0.02</decay_rate>
            </physical_parameter_set>
            <initial_condition units="dimensionless">0.0</initial_condition>
            <Dirichlet_boundary_condition units="dimensionless" enabled="false">0.0</Dirichlet_boundary_condition>
        </variable>

        <!-- Collagen I: Another key fibrosis marker -->
        <variable name="collagen_I" units="dimensionless" ID="3">
            <physical_parameter_set>
                <diffusion_coefficient units="micron^2/min">5000.0</diffusion_coefficient>
                <decay_rate units="1/min">0.005</decay_rate>  <!-- More stable than α-SMA -->
            </physical_parameter_set>
            <initial_condition units="dimensionless">0.0</initial_condition>
            <Dirichlet_boundary_condition units="dimensionless" enabled="false">0.0</Dirichlet_boundary_condition>
        </variable>

        <options>
            <calculate_gradients>true</calculate_gradients>
            <track_internalized_substrates_in_each_agent>true</track_internalized_substrates_in_each_agent>
        </options>
    </microenvironment_setup>

    <cell_definitions>
        <!-- Quiescent LX-2 cells: Normal hepatic stellate cell state -->
        <cell_definition name="LX2_quiescent" ID="0">
            <phenotype>
                <cycle code="5" name="live">
                    <phase_durations units="min">
                        <duration index="0" fixed_duration="false">2000.0</duration> <!-- Long G0/G1 for quiescent -->
                    </phase_durations>
                </cycle>

                <death>
                    <model code="100" name="apoptosis">
                        <death_rate units="1/min">0.0001</death_rate>  <!-- Low death rate -->
                        <phase_durations units="min">
                            <duration index="0" fixed_duration="true">516</duration>
                        </phase_durations>
                        <parameters>
                            <unlysed_fluid_change_rate units="1/min">0.05</unlysed_fluid_change_rate>
                            <lysed_fluid_change_rate units="1/min">0</lysed_fluid_change_rate>
                            <cytoplasmic_biomass_change_rate units="1/min">1.66667e-02</cytoplasmic_biomass_change_rate>
                            <nuclear_biomass_change_rate units="1/min">5.83333e-03</nuclear_biomass_change_rate>
                            <calcification_rate units="1/min">0</calcification_rate>
                            <relative_rupture_volume units="dimensionless">2.0</relative_rupture_volume>
                        </parameters>
                    </model>
                    <model code="101" name="necrosis">
                        <death_rate units="1/min">0.0</death_rate>
                        <phase_durations units="min">
                            <duration index="0" fixed_duration="true">0</duration>
                            <duration index="1" fixed_duration="true">86400</duration>
                        </phase_durations>
                        <parameters>
                            <unlysed_fluid_change_rate units="1/min">0.05</unlysed_fluid_change_rate>
                            <lysed_fluid_change_rate units="1/min">0</lysed_fluid_change_rate>
                            <cytoplasmic_biomass_change_rate units="1/min">1.66667e-02</cytoplasmic_biomass_change_rate>
                            <nuclear_biomass_change_rate units="1/min">5.83333e-03</nuclear_biomass_change_rate>
                            <calcification_rate units="1/min">0</calcification_rate>
                            <relative_rupture_volume units="dimensionless">2.0</relative_rupture_volume>
                        </parameters>
                    </model>
                </death>

                <volume>
                    <total units="micron^3">2494</total>
                    <fluid_fraction units="dimensionless">0.75</fluid_fraction>
                    <nuclear units="micron^3">540</nuclear>
                    <fluid_change_rate units="1/min">0.05</fluid_change_rate>
                    <cytoplasmic_biomass_change_rate units="1/min">0.0045</cytoplasmic_biomass_change_rate>
                    <nuclear_biomass_change_rate units="1/min">0.0055</nuclear_biomass_change_rate>
                    <calcified_fraction units="dimensionless">0</calcified_fraction>
                    <calcification_rate units="1/min">0</calcification_rate>
                    <relative_rupture_volume units="dimensionless">2.0</relative_rupture_volume>
                </volume>

                <mechanics>
                    <cell_cell_adhesion_strength units="micron/min">0.4</cell_cell_adhesion_strength>
                    <cell_cell_repulsion_strength units="micron/min">10.0</cell_cell_repulsion_strength>
                    <relative_maximum_adhesion_distance units="dimensionless">1.25</relative_maximum_adhesion_distance>
                    <options>
                        <set_relative_equilibrium_distance enabled="false" units="dimensionless">1.8</set_relative_equilibrium_distance>
                        <set_absolute_equilibrium_distance enabled="false" units="micron">15.12</set_absolute_equilibrium_distance>
                    </options>
                </mechanics>

                <motility>
                    <speed units="micron/min">0.2</speed>  <!-- Low motility for quiescent -->
                    <persistence_time units="min">10</persistence_time>
                    <migration_bias units="dimensionless">0.0</migration_bias>
                    <options>
                        <enabled>true</enabled>
                        <use_2D>true</use_2D>
                        <chemotaxis>
                            <enabled>false</enabled>
                            <substrate>TGF_beta1</substrate>
                            <direction>1</direction>
                        </chemotaxis>
                    </options>
                </motility>

                <secretion>
                    <!-- Minimal fibrosis marker secretion in quiescent state -->
                    <substrate name="alpha_SMA">
                        <secretion_rate units="1/min">0.1</secretion_rate>
                        <secretion_target units="substrate density">1.0</secretion_target>
                        <uptake_rate units="1/min">0</uptake_rate>
                        <net_export_rate units="total substrate/min">0</net_export_rate>
                    </substrate>
                    <substrate name="collagen_I">
                        <secretion_rate units="1/min">0.05</secretion_rate>
                        <secretion_target units="substrate density">0.5</secretion_target>
                        <uptake_rate units="1/min">0</uptake_rate>
                        <net_export_rate units="total substrate/min">0</net_export_rate>
                    </substrate>
                    <!-- Exosome uptake mechanism -->
                    <substrate name="exosomes">
                        <secretion_rate units="1/min">0</secretion_rate>
                        <secretion_target units="substrate density">0</secretion_target>
                        <uptake_rate units="1/min">1.0</uptake_rate>  <!-- Active endocytosis -->
                        <net_export_rate units="total substrate/min">0</net_export_rate>
                    </substrate>
                </secretion>

                <molecular />
            </phenotype>
            <custom_data>
                <!-- Cell activation state -->
                <activation_level conserved="false" units="dimensionless" description="0=quiescent, 1=activated">0.0</activation_level>
                
                <!-- miRNA content tracking -->
                <miR_455_3p_level conserved="true" units="dimensionless" description="Intracellular miR-455-3p concentration">0.0</miR_455_3p_level>
                <miR_148a_5p_level conserved="true" units="dimensionless" description="Intracellular miR-148a-5p concentration">0.0</miR_148a_5p_level>
                
                <!-- Fibrosis markers -->
                <alpha_SMA_production conserved="false" units="1/min" description="Rate of α-SMA production">0.1</alpha_SMA_production>
                <collagen_I_production conserved="false" units="1/min" description="Rate of Collagen I production">0.05</collagen_I_production>
                
                <!-- Exosome interaction -->
                <exosome_uptake_rate conserved="false" units="1/min" description="Rate of exosome endocytosis">1.0</exosome_uptake_rate>
                <last_exosome_uptake conserved="false" units="min" description="Time since last exosome uptake">0.0</last_exosome_uptake>
                
                <!-- miRNA effects -->
                <miR_455_3p_effect conserved="false" units="dimensionless" description="Inhibition effect of miR-455-3p">0.0</miR_455_3p_effect>
                <miR_148a_5p_effect conserved="false" units="dimensionless" description="Inhibition effect of miR-148a-5p">0.0</miR_148a_5p_effect>
                <synergy_factor conserved="false" units="dimensionless" description="Synergistic enhancement when both miRNAs present">1.0</synergy_factor>
            </custom_data>
        </cell_definition>

        <!-- Activated LX-2 cells: Fibrotic hepatic stellate cell state -->
        <cell_definition name="LX2_activated" ID="1" parent_type="LX2_quiescent">
            <phenotype>
                <cycle code="6" name="Flow cytometry model (separated)">
                    <phase_durations units="min">
                        <duration index="0" fixed_duration="false">480.0</duration>  <!-- Faster cycling -->
                        <duration index="1" fixed_duration="true">230.0</duration>
                        <duration index="2" fixed_duration="true">240.0</duration>
                        <duration index="3" fixed_duration="true">60.0</duration>
                    </phase_durations>
                </cycle>

                <motility>
                    <speed units="micron/min">1.0</speed>  <!-- Higher motility when activated -->
                    <persistence_time units="min">15</persistence_time>
                    <migration_bias units="dimensionless">0.0</migration_bias>
                    <options>
                        <enabled>true</enabled>
                        <use_2D>true</use_2D>
                        <chemotaxis>
                            <enabled>false</enabled>
                            <substrate>TGF_beta1</substrate>
                            <direction>1</direction>
                        </chemotaxis>
                    </options>
                </motility>

                <secretion>
                    <!-- High fibrosis marker secretion in activated state -->
                    <substrate name="alpha_SMA">
                        <secretion_rate units="1/min">2.0</secretion_rate>  <!-- 20x higher than quiescent -->
                        <secretion_target units="substrate density">10.0</secretion_target>
                        <uptake_rate units="1/min">0</uptake_rate>
                        <net_export_rate units="total substrate/min">0</net_export_rate>
                    </substrate>
                    <substrate name="collagen_I">
                        <secretion_rate units="1/min">1.5</secretion_rate>  <!-- 30x higher than quiescent -->
                        <secretion_target units="substrate density">8.0</secretion_target>
                        <uptake_rate units="1/min">0</uptake_rate>
                        <net_export_rate units="total substrate/min">0</net_export_rate>
                    </substrate>
                    <!-- Maintain exosome uptake capability -->
                    <substrate name="exosomes">
                        <secretion_rate units="1/min">0</secretion_rate>
                        <secretion_target units="substrate density">0</secretion_target>
                        <uptake_rate units="1/min">1.0</uptake_rate>
                        <net_export_rate units="total substrate/min">0</net_export_rate>
                    </substrate>
                </secretion>
            </phenotype>
            <custom_data>
                <activation_level conserved="false" units="dimensionless" description="0=quiescent, 1=activated">1.0</activation_level>
                <alpha_SMA_production conserved="false" units="1/min" description="Rate of α-SMA production">2.0</alpha_SMA_production>
                <collagen_I_production conserved="false" units="1/min" description="Rate of Collagen I production">1.5</collagen_I_production>
            </custom_data>
        </cell_definition>
    </cell_definitions>
    
    <initial_conditions>
        <cell_positions enabled="false" type="csv">
            <folder>./config</folder>
            <filename>cells.csv</filename>
        </cell_positions>
    </initial_conditions>
    
    <user_parameters>
        <!-- Experimental condition parameters -->
        <TGF_beta1_concentration type="double" units="ng/mL" description="Concentration of TGF-β1 for activation">10.0</TGF_beta1_concentration>
        <exosome_concentration type="double" units="ug/mL" description="Total exosome concentration">50.0</exosome_concentration>
        
        <!-- Experimental group selection -->
        <experimental_group type="string" description="Experimental condition">control</experimental_group>
        <!-- Options: control, positive_model, natural_exosomes, NC_mimic, miR_455_3p, miR_148a_5p, dual_miRNA_1_1, dual_miRNA_1_2, dual_miRNA_2_1 -->
        
        <!-- miRNA composition in exosomes -->
        <miR_455_3p_ratio type="double" units="dimensionless" description="Proportion of miR-455-3p in dual loading">0.5</miR_455_3p_ratio>
        <miR_148a_5p_ratio type="double" units="dimensionless" description="Proportion of miR-148a-5p in dual loading">0.5</miR_148a_5p_ratio>
        
        <!-- Kinetic parameters -->
        <activation_threshold type="double" units="ng/mL" description="TGF-β1 threshold for LX-2 activation">5.0</activation_threshold>
        <miRNA_degradation_rate type="double" units="1/min" description="Rate of intracellular miRNA degradation">0.01</miRNA_degradation_rate>
        <miRNA_effect_threshold type="double" units="dimensionless" description="miRNA level threshold for anti-fibrotic effect">0.1</miRNA_effect_threshold>
        
        <!-- Synergy parameters -->
        <synergy_threshold type="double" units="dimensionless" description="Minimum miRNA levels for synergy">0.1</synergy_threshold>
        <max_synergy_factor type="double" units="dimensionless" description="Maximum synergistic enhancement">2.5</max_synergy_factor>
        
        <!-- Initial cell population -->
        <initial_LX2_count type="int" units="dimensionless" description="Initial number of LX-2 cells">100</initial_LX2_count>
        <initial_activation_fraction type="double" units="dimensionless" description="Fraction initially activated by TGF-β1">0.0</initial_activation_fraction>
    </user_parameters>
    
</PhysiCell_settings>
